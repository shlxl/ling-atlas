name: "PR-G 安全与合规"
description: "为站点加入 CSP、安全头与 SRI，并在 CI 中自动校验；纯静态方案且不破坏现有构建与 BASE 路径"
title: "[PR-G] 安全与合规（CSP / SRI / security-headers）"
labels:
  - security
  - ci
  - automation
body:
  - type: markdown
    attributes:
      value: |
        ## 🎯 目标
        - 为 Ling-Atlas 提供静态安全头（CSP、Referrer、Permissions 等）与 Subresource Integrity（SRI）清单；
        - 在构建后自动生成并校验；若外部 CDN 变更但 SRI 未更新则 CI fail；
        - 纯静态实现（meta CSP 或 `.well-known` 文本/JSON），不改变现有构建与 BASE 路径逻辑；
        - 零破坏：功能与本地 dev/preview 不受影响。
  - type: markdown
    attributes:
      value: |
        ## 🧩 任务拆解
        ...
        #（此处省略中间内容，可填入你原有的分解任务，注意保持缩进与格式）#
        ...
  - type: checkboxes
    id: acceptance
    attributes:
      label: "✅ 验收标准"
      options:
        - label: "Lighthouse Best Practices ≥ 95 且控制台无 CSP 违规（本地/CI 复现）"
          required: true
        - label: "所有外链资源均在 `sri-manifest.json` 中，且使用处附带 `integrity` + `crossorigin=\"anonymous\"`"
          required: true
        - label: "`security-headers.txt`（可通过 `/.well-known/security-headers.txt` 访问）与 `sri-manifest.json` 存在并被发布到 `dist/`"
          required: true
        - label: "CI 在外部 CDN 变更导致 SRI 不匹配时 fail；且可通过维护白名单/更新 SRI 恢复"
          required: true
  - type: textarea
    id: logs
    attributes:
      label: "🧪 验证与日志（建议在 Issue 中贴上）"
      description: "CI 运行后请粘贴关键日志片段（SRI 列表、CSP 摘要、任何报错）"
      placeholder: |
        [generate-headers] wrote docs/public/.well-known/security-headers.txt
        [sri] computed 4 integrity entries:
          - https://esm.sh/.. -> sha384-...
        [ci] copied .well-known/* -> dist/.well-known/
        [ci] Lighthouse best-practices: 96
  - type: markdown
    attributes:
      value: |
        ## ⚙️ 实施细节与约束
        ...
  - type: markdown
    attributes:
      value: |
        ## 🔁 回滚策略
        ...
  - type: markdown
    attributes:
      value: |
        ## 📎 推荐输出物（PR 应包含）
        ...
  - type: markdown
    attributes:
      value: |
        ## 实施提示（工程师小贴士）
        ...
