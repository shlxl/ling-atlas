---
name: "PR-M ä¾›åº”é“¾åŠ å›º 2.0"
description: "å®Œå–„ä¾èµ–ä¸å¤–éƒ¨èµ„æºçš„å¯å®¡è®¡æ€§ï¼šé”å®šå®‰è£…ã€ç”Ÿæˆ SBOMã€SRI å‡çº§ä¸ºå¯¹æ¯”æ ¡éªŒï¼›ä»»ä½•å¤–éƒ¨è„šæœ¬/CDN å˜æ›´å¿…é¡»è§¦å‘çº¢ç¯"
title: "[PR-M] ä¾›åº”é“¾åŠ å›º 2.0ï¼ˆnpm ci / SBOM / SRI å¯¹æ¯”ï¼‰"
labels: ["security", "supply-chain", "ci", "compliance"]

body:
  - type: markdown
    attributes:
      value: |
        ## ğŸ¯ ç›®æ ‡ä¸çº¦æŸ
        - **é”å®šå®‰è£… + å®¡è®¡**ï¼šå¼ºåˆ¶ `npm ci`ï¼Œæä¾›ä¾èµ–æ¼æ´ä¸ License æ¦‚è§ˆã€‚
        - **SBOM**ï¼šç”Ÿæˆ CycloneDXï¼Œå‘å¸ƒä¸ºé™æ€æ–‡ä»¶ä»¥ä¾¿å®¡è®¡/å¯¹å¤–æŠ«éœ²ã€‚
        - **SRI ç»­å‘½**ï¼šæ¯”è¾ƒä¸Šæ¬¡ `sri-manifest.json` ä¸æœ¬æ¬¡è®¡ç®—å€¼ï¼Œè‹¥ä¸ä¸€è‡´åˆ™ **CI fail** å¹¶æ‰“å° diffï¼›æ‰€æœ‰å¤–é“¾å¿…é¡»åœ¨ç™½åå•ã€‚
        - ä¸æ˜¾è‘—å½±å“æ„å»ºæ€§èƒ½ï¼›å¤±è´¥æ—¶ç»™å‡º**æ˜ç¡®ä¿®å¤å»ºè®®**ã€‚

  - type: checkboxes
    id: acceptance
    attributes:
      label: "âœ… éªŒæ”¶æ ‡å‡†"
      options:
        - label: "CI ä½¿ç”¨ `npm ci`ï¼Œæ—¥å¿—ä¸­åŒ…å« `audit` ä¸ `license` æ‘˜è¦"
          required: true
        - label: "ç”Ÿæˆ CycloneDX SBOM å¹¶å‘å¸ƒä¸º `/.well-known/sbom.json` å¯è®¿é—®"
          required: true
        - label: "`scripts/sri.mjs` å¯¹æ¯”ä¸Šæ¬¡ `sri-manifest.json`ï¼Œä»»æ„å¤–é“¾å˜æ›´å³ **CI fail** å¹¶æ‰“å° diff"
          required: true
        - label: "å¤–é“¾èµ„æºå‡åœ¨ç™½åå•ä¸­å¹¶é™„ `integrity` + `crossorigin=\"anonymous\"`"
          required: true

  - type: textarea
    id: tasks
    attributes:
      label: "ğŸ“‹ ä»»åŠ¡åˆ—è¡¨"
      description: "è¯·æ ¹æ®ä¸‹æ–¹æ¸…å•é€é¡¹æ‰“å‹¾æˆ–è¡¥å……è¯´æ˜"
      value: |
        - [ ] CI å¼ºåˆ¶ä½¿ç”¨ `npm ci`
        - [ ] æ–°å¢ npm scriptsï¼šauditã€license
        - [ ] è¾“å‡ºä¾èµ–æ¼æ´ä¸ License æ‘˜è¦
        - [ ] ç”Ÿæˆ CycloneDX SBOM å¹¶å‘å¸ƒ
        - [ ] CI æ—¥å¿—æ‰“å° SBOM è·¯å¾„+å“ˆå¸Œ
        - [ ] SRI æ ¡éªŒä¸ç™½åå•æ¯”å¯¹
        - [ ] CI é›†æˆé¡ºåºè§„èŒƒ
        - [ ] `.well-known/*` æ‹·è´è‡³ `dist/.well-known/`

  - type: textarea
    id: whitelist
    attributes:
      label: "ğŸ” å¤–é“¾ç™½åå•ï¼ˆç¤ºä¾‹ï¼‰"
      description: "åˆ—å‡ºå…è®¸çš„ CDN ä¸å›ºå®šç‰ˆæœ¬ URL ç‰‡æ®µï¼›é¿å…ä½¿ç”¨æµ®åŠ¨ç‰ˆæœ¬"
      value: |
        {
          "allowed": [
            "https://esm.sh/@xenova/transformers@0.15.1/",
            "https://cdn.jsdelivr.net/npm/pagefind@1.1.0/"
          ]
        }

  - type: textarea
    id: sri-diff
    attributes:
      label: "ğŸ§ª SRI å¯¹æ¯”æ—¥å¿—ï¼ˆç¤ºä¾‹ï¼‰"
      description: "ç²˜è´´ä¸€æ¬¡å¤–é“¾å˜æ›´æ—¶çš„ CI è¾“å‡ºï¼ˆåŒ…å«å·®å¼‚ä¸ä¿®å¤å»ºè®®ï¼‰"
      value: |
        [sri] diff:
          MODIFIED https://esm.sh/...:
            old: sha384-AAAA...
            new: sha384-BBBB...
        âŒ Fail: å¤–é“¾å“ˆå¸Œå˜åŒ–ï¼Œè¯·ç¡®è®¤å‡çº§æ„å›¾ï¼š
           1) æ›´æ–° scripts/sri.config.json å›ºå®šç‰ˆæœ¬
           2) é‡æ–°è¿è¡Œè„šæœ¬ç”Ÿæˆæ–° manifest
           3) ç¡®è®¤ HTML/worker æ³¨å…¥äº†æ–°çš„ integrity

  - type: markdown
    attributes:
      value: |
        ## âš™ï¸ å®æ–½æç¤º
        - `npm ci` éœ€é…åˆ `package-lock.json` ä¸€å¹¶æäº¤ï¼›è‹¥ lock æ”¹åŠ¨ï¼Œè¯·åœ¨ PR æè¿°ä¸­è§£é‡ŠåŸå› ã€‚
        - `license-checker --summary` è¾“å‡ºå¯å…¥åº“åˆ° artifactï¼Œå¿…è¦æ—¶é™„è®¸å¯è¯ç™½åå•ç­–ç•¥ã€‚
        - SBOM ä½œä¸º `.well-known/sbom.json` å¯¹å¤–å¯è®¿é—®ï¼Œä¾¿äºç¬¬ä¸‰æ–¹åˆè§„æ‰«æã€‚
        - SRI å¯¹æ¯”å»ºè®®åœ¨å˜æ›´æ—¶ç»™å‡º**ä¿®å¤è·¯å¾„æç¤º**ï¼ˆå›ºå®šç‰ˆæœ¬ã€æ›´æ–°ç™½åå•ã€é‡æ–°è®¡ç®— SRIï¼‰ã€‚

  - type: markdown
    attributes:
      value: |
        ## ğŸ” å›æ»šç­–ç•¥
        - ä¸´æ—¶è·³è¿‡ `audit` / `SBOM` / `SRI` æ­¥éª¤ï¼ˆCI ä¸­æ³¨é‡Šæˆ–æ¡ä»¶å˜é‡ï¼‰ï¼Œä¸å½±å“ä¸šåŠ¡åŠŸèƒ½ï¼›
        - ä½† SRI æ ¡éªŒå…³é—­ä¼šé™ä½ä¾›åº”é“¾å˜æ›´çš„å¯è§æ€§ï¼Œåº”å°½å¿«æ¢å¤ã€‚
