name: "PR-H PWA ç¦»çº¿ç¼“å­˜"
description: "é›†æˆ PWAï¼šå¯å®‰è£…ã€å¯ç¦»çº¿æ‰“å¼€æœ€è¿‘è®¿é—®é¡µï¼›ç¼“å­˜ Pagefind ä¸ embeddingsï¼ˆåªè¯»ï¼‰ï¼Œä¸æ”¹å˜æœç´¢é€»è¾‘ï¼Œä»…å¢åŠ ç¼“å­˜å±‚"
title: "[PR-H] PWA ç¦»çº¿ç¼“å­˜ï¼ˆå¯å®‰è£…/ç¦»çº¿ç´¢å¼•ï¼‰"
labels: ["pwa", "offline", "performance", "ci"]
body:
  - type: markdown
    attributes:
      value: |
        ## ğŸ¯ ç›®æ ‡ä¸çº¦æŸ
        - è®©ç½‘ç«™ **å¯å®‰è£…**ã€**å¯ç¦»çº¿æ‰“å¼€æœ€è¿‘è®¿é—®é¡µ**ï¼›
        - ç¦»çº¿æ—¶ä½¿ç”¨**ä¸Šæ¬¡ç¼“å­˜çš„ Pagefind ç´¢å¼•ä¸ embeddings-texts.jsonï¼ˆåªè¯»ï¼‰**ï¼›
        - æ¨¡å‹ä¸ç´¢å¼• **æ‡’åŠ è½½**ï¼Œç¦»çº¿ä»…ç”¨å·²ç¼“å­˜èµ„æºï¼Œ**é¦–å±ä¸é˜»å¡**ï¼›
        - **BASE å­è·¯å¾„**ä¸‹ PWA å¯ç”¨ï¼ˆé¡¹ç›®ç«™ç‚¹ï¼‰ï¼›
        - ä¸æ”¹å˜ç°æœ‰**æœç´¢é€»è¾‘**ï¼Œä»…å¢åŠ ç¼“å­˜å±‚ã€‚

  - type: markdown
    attributes:
      value: |
        ## ğŸ§© ä»»åŠ¡æ‹†è§£

        ### 1) é›†æˆ `vite-plugin-pwa`
        - devDep: `vite-plugin-pwa`
        - ä¿®æ”¹ `docs/.vitepress/config.ts`ï¼Œå¼•å…¥ PWA æ’ä»¶å¹¶é…ç½®ï¼š
          - **manifest**ï¼š`name` / `short_name` / `icons[]` / `start_url = BASE`
          - **workbox**ï¼š
            - `globPatterns` è¦†ç›–ï¼š`**/*.{js,css,html}`, `pagefind/**`, `embeddings-texts.json`, `worker/**`
            - `navigateFallback` é€‚é… BASE
          - **caching ç­–ç•¥**ï¼š
            - HTMLï¼š`NetworkFirst`
            - é™æ€èµ„æºï¼š`StaleWhileRevalidate`
          - **runtimeCaching**ï¼ˆç¤ºä¾‹ï¼‰ï¼š
            - `urlPattern: /pagefind/` â†’ `StaleWhileRevalidate`
            - `urlPattern: /embeddings-texts\.json$/` â†’ `StaleWhileRevalidate`
            - `urlPattern: /worker/embeddings\.worker\.js$/` â†’ `CacheFirst`
          - `registerType: "autoUpdate"`ï¼ˆæ–° SW å°±ç»ªåè§¦å‘æ›´æ–°äº‹ä»¶ï¼‰

        ### 2) UI æç¤ºï¼šæ–°ç‰ˆæœ¬å¯ç”¨
        - åœ¨ä¸»é¢˜å±‚ `Layout.vue` å¢åŠ â€œæœ‰æ›´æ–°ï¼Œç‚¹å‡»åˆ·æ–°â€çš„æç¤ºæ¡ï¼š
          - ç›‘å¬ workbox çš„ `waiting` / `activated` çŠ¶æ€ï¼›
          - æä¾› â€œåˆ·æ–°ä»¥æ›´æ–°â€ æŒ‰é’®ï¼ˆè°ƒç”¨ `WB.messageSkipWaiting()` + `window.location.reload()`ï¼‰

        ### 3) æ„å»ºä¸ CI
        - æ–°å¢ npm è„šæœ¬ï¼š
          ```json
          { "scripts": { "pwa:build": "vitepress build docs" } }
          ```
          > æ³¨ï¼šå¯ç”¨æ’ä»¶åå¸¸è§„ `build` å³ä¼šç”Ÿæˆ PWA å·¥ä»¶ï¼Œå¦‚æ— éœ€å•ç‹¬è„šæœ¬ï¼Œå¯ç›´æ¥æ²¿ç”¨ç°æœ‰ `build`ã€‚
        - CI ä¿æŒç°æœ‰æ„å»ºé¡ºåºä¸å˜ï¼ˆä¸ Pagefind/embeddings æ„å»ºå…¼å®¹ï¼‰ï¼›
        - éªŒè¯ `dist/` ä¸‹ç”Ÿæˆï¼š`manifest.webmanifest`ã€`sw.js`ã€`workbox-*` ç­‰å·¥ä»¶ï¼Œå¹¶æ­£ç¡®åŒ…å«åœ¨ BASE è·¯å¾„ä¸‹ã€‚

        ### 4) éªŒæ”¶è„šæœ¬ï¼ˆå¯é€‰ï¼‰
        - ä½¿ç”¨ Lighthouse CI å¢åŠ  PWA æ£€æŸ¥ï¼Œç›®æ ‡ï¼š**PWA å¾—åˆ† â‰¥ 90**ï¼ˆä¸å¼ºåˆ¶ï¼Œä½†å»ºè®®ï¼‰ã€‚

  - type: checkboxes
    id: acceptance
    attributes:
      label: âœ… éªŒæ”¶æ ‡å‡†
      options:
        - label: æµè§ˆå™¨æä¾›â€œå®‰è£…â€å…¥å£ï¼ˆAdd to Home Screen/Install Appï¼‰
          required: true
        - label: æ–­ç½‘åå¯é‡æ–°æ‰“å¼€**æœ€è¿‘è®¿é—®é¡µé¢**ï¼›è‹¥ç´¢å¼•å·²ç¼“å­˜ï¼Œæœç´¢åœ¨ç¦»çº¿ä¸‹å¯ä½¿ç”¨ç¼“å­˜ï¼›æœªç¼“å­˜æ—¶ä¼˜é›…é™çº§
          required: true
        - label: æ–°ç‰ˆæœ¬éƒ¨ç½²åé¡µé¢å‡ºç°â€œæœ‰æ›´æ–°ï¼Œç‚¹å‡»åˆ·æ–°â€æç¤ºï¼Œå¹¶å¯ä¸€é”®åˆ·æ–°ç”Ÿæ•ˆ
          required: true
        - label: BASE å­è·¯å¾„ä¸‹ PWA æ­£å¸¸å·¥ä½œï¼›`manifest.webmanifest`ã€`sw.js`ã€`workbox-*` å­˜åœ¨äº `dist/`
          required: true

  - type: textarea
    id: config-diff
    attributes:
      label: ğŸ§¾ é…ç½®ä¸ç¼“å­˜ç­–ç•¥æ‘˜è¦
      description: ç²˜è´´ `docs/.vitepress/config.ts` ä¸­ PWA é…ç½® diff ä¸ `runtimeCaching` å…³é”®æ¡ç›®
      placeholder: |
        - manifest.start_url / scope / icons
        - workbox.globPatterns / navigateFallback
        - runtimeCachingï¼ˆä¸‰æ¡è§„åˆ™ï¼‰ä¸ç­–ç•¥è¯´æ˜

  - type: textarea
    id: offline-demo
    attributes:
      label: ğŸ§ª æœ¬åœ°ç¦»çº¿æ¼”ç¤ºè¯´æ˜
      description: æè¿°å¦‚ä½•åœ¨ DevTools/æµè§ˆå™¨ä¸­éªŒè¯ç¦»çº¿è¡Œä¸ºä¸æœç´¢çš„ç¼“å­˜é™çº§è·¯å¾„ï¼›é™„æ§åˆ¶å°æˆªå›¾/æ—¥å¿—æ›´ä½³
      placeholder: |
        - æ‰“å¼€æŸæ–‡æ¡£é¡µ â†’ åˆ·æ–° â†’ å¼€å¯ Offline â†’ é‡è½½é¡µé¢
        - æœç´¢æ¡†ï¼šåœ¨ç¦»çº¿å‰è¿›è¡Œä¸€æ¬¡æŸ¥è¯¢ä»¥ç¼“å­˜ Pagefind/embeddingsï¼›æ–­ç½‘åå†æ¬¡æŸ¥è¯¢éªŒè¯
        - æ§åˆ¶å°ï¼šworkbox ç¼“å­˜å‘½ä¸­æ—¥å¿—

  - type: markdown
    attributes:
      value: |
        ## ğŸ” å›æ»šç­–ç•¥
        - æ³¨é‡Š/ç§»é™¤ PWA æ’ä»¶é…ç½®ä¸æ³¨å†Œä»£ç ï¼›
        - åˆ é™¤ç”Ÿæˆçš„ `sw.js` / `workbox-*` / `manifest.webmanifest`ï¼›
        - ä¸å½±å“æ ¸å¿ƒåŠŸèƒ½ä¸æœç´¢é€»è¾‘ï¼ˆä»…å¤±å»ç¦»çº¿ä¸å®‰è£…èƒ½åŠ›ï¼‰ã€‚

  - type: markdown
    attributes:
      value: |
        ## ğŸ“ è¾“å‡ºç‰©ï¼ˆPR åº”åŒ…å«ï¼‰
        - `docs/.vitepress/config.ts` ä¸­çš„ PWA é…ç½® diffï¼ˆmanifestã€workboxã€runtimeCachingã€registerTypeï¼‰
        - ä¸»é¢˜ `Layout.vue` çš„â€œæ–°ç‰ˆæœ¬å¯ç”¨â€æç¤ºå®ç°
        - `dist/` ä¸­çš„ PWA å·¥ä»¶æˆªå›¾/åˆ—è¡¨
        - ï¼ˆå¯é€‰ï¼‰Lighthouse CI çš„ PWA åˆ†æ•°ä¸å…³é”®å»ºè®®ç‰‡æ®µ
